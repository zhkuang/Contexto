# 翻译同步功能使用指南

## 功能概述

Contexto 的翻译同步功能可以将翻译结果同步到指定的语言文件中。该功能会根据源语言文件中的键，将对应的翻译结果写入到目标语言文件中，保持原有的嵌套结构。

> **界面说明**: 在插件界面中，此功能显示为"同步翻译"按钮。

## 🎯 同步策略

为解决多语言导出中的混合内容问题，Contexto 提供了4种导出策略：

### 1. 仅导出已翻译内容 (推荐)
- **策略**: `skip`
- **行为**: 只导出已有翻译的键，跳过未翻译的键
- **优点**: 避免不同语言混合，保持文件纯净
- **适用**: 生产环境，完整翻译后的文件

```json
{
    "common": {
        "cancel": "Cancel"    // ✅ 只包含已翻译的键
    },
    "user": {
        "login": "Login",
        "username": "Username"
    }
}
```

### 2. 包含占位符
- **策略**: `placeholder`
- **行为**: 未翻译的键使用占位符标记
- **优点**: 清楚标识哪些键需要翻译
- **适用**: 开发阶段，翻译进度跟踪

```json
{
    "common": {
        "ok": "[需要en翻译: 确定]",     // ❌ 占位符，需要翻译
        "cancel": "Cancel"            // ✅ 已翻译
    }
}
```

### 3. 使用源文本填充
- **策略**: `source`
- **行为**: 未翻译的键使用源语言文本
- **优点**: 保持文件完整性
- **缺点**: 可能造成多语言混合
- **适用**: 测试环境，临时使用

```json
{
    "common": {
        "ok": "确定",          // ❌ 中文原文，需要翻译
        "cancel": "Cancel"     // ✅ 英文翻译
    }
}
```

### 4. 使用键名填充
- **策略**: `key`
- **行为**: 未翻译的键显示为键名
- **优点**: 便于调试和定位
- **适用**: 开发调试

```json
{
    "common": {
        "ok": "common.ok",     // ❌ 键名，需要翻译
        "cancel": "Cancel"     // ✅ 已翻译
    }
}
```

## 修复内容

### 🐛 已修复的问题
1. **混合语言问题**: 修复了英文文件中出现中文文本的问题
2. **通用解决方案**: 不再针对特定文件，提供了通用的策略选择机制
3. **用户体验**: 增加了导出策略选择界面，用户可根据需求选择合适策略

## 配置格式

### 字符串格式（默认）
```json
{
    "targetLangs": [
        "en",
        "zh-TW", 
        "ja"
    ]
}
```

### 对象格式（自定义输出路径）
```json
{
    "targetLangs": [
        {
            "lang": "en",
            "outputPath": "./locales/english.json"
        },
        {
            "lang": "zh-TW", 
            "outputPath": "./i18n/traditional-chinese.json"
        },
        "ja"
    ]
}
```

## 使用步骤

1. **配置目标语种**: 在 `config.json` 中配置 `targetLangs`
2. **执行翻译**: 点击"一键翻译"按钮，确保有翻译数据可以同步
3. **同步文件**: 点击"同步翻译"按钮
4. **选择策略**: 根据需求选择合适的同步策略
5. **确认同步**: 查看同步预览，点击"确认同步"执行

## 策略选择建议

| 使用场景 | 推荐策略 | 说明 |
|---------|----------|------|
| 生产环境 | `skip` | 只导出完整翻译，避免混合语言 |
| 开发测试 | `placeholder` | 清楚标识待翻译内容 |
| 翻译审查 | `placeholder` | 便于翻译人员识别工作量 |
| 临时使用 | `source` | 保持功能完整性 |
| 调试定位 | `key` | 便于开发人员定位问题 |

## 支持的文件格式

- **JSON**: `.json` - 标准JSON格式，支持嵌套对象
- **Android XML**: `.xml` - Android strings.xml 格式  
- **iOS Strings**: `.strings` - iOS Localizable.strings 格式
- **Flutter ARB**: `.arb` - Application Resource Bundle 格式

## 注意事项

1. **默认策略**: 系统默认使用 `skip` 策略，确保导出文件的语言纯净性
2. **翻译完整性**: 使用 `skip` 策略时，建议先完成翻译再导出
3. **文件覆盖**: 导出会覆盖已存在的文件，请谨慎操作
4. **警告信息**: 系统会提示有多少键缺少翻译，帮助跟踪进度

## 故障排除

### 如果导出的文件缺少内容：
1. 检查使用的是否为 `skip` 策略
2. 确认这些键是否已完成翻译
3. 考虑使用 `placeholder` 策略查看完整结构

### 如果导出的文件有混合语言：
1. 检查是否使用了 `source` 策略
2. 建议改用 `skip` 或 `placeholder` 策略
3. 完成缺失的翻译后重新导出
