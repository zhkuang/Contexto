# 导出功能问题修复报告

## 问题描述
用户反馈导出的翻译文件中，很多值显示为键名（如 "common.ok", "common.save"）而不是实际的翻译文本，导致导出的文件不可用。

## 根本原因
导出逻辑中，当缓存中没有对应键的翻译时，fallback机制使用的是键名而不是源文件中的原始文本。具体问题：

1. **缓存不完整**: 缓存中只包含已翻译的键，而源文件中可能有更多键
2. **错误的fallback**: 当缓存中没有翻译时，使用 `key` 作为fallback，而不是源文件中的实际文本值
3. **数据源分离**: 导出时没有同时引用源文件数据和缓存数据

## 修复方案

### 修改前的逻辑
```typescript
// 错误的fallback逻辑
translationData[key] = cacheItem?.source || key;
```

### 修改后的逻辑
```typescript
// 正确的fallback逻辑 - 从源文件获取原始值
translationData[key] = sourceData[key] || key;
```

### 具体修改

1. **修改导出方法签名**: 同时传递源数据和缓存数据
2. **改进fallback机制**: 优先使用翻译，其次使用源文件原始文本
3. **增加统计反馈**: 告知用户有多少键使用了fallback

## 修复效果

### 修复前
```json
{
    "common": {
        "ok": "common.ok",        // ❌ 显示键名
        "cancel": "取消",         // ✅ 正确翻译
        "save": "common.save"     // ❌ 显示键名
    }
}
```

### 修复后  
```json
{
    "common": {
        "ok": "确定",            // ✅ 源文件原始文本
        "cancel": "取消",        // ✅ 正确翻译  
        "save": "保存"           // ✅ 源文件原始文本
    }
}
```

## 验证结果

✅ **有翻译的键**: 使用正确的目标语言翻译
✅ **无翻译的键**: 使用源文件中的原始文本作为fallback  
✅ **嵌套结构**: 正确重建JSON嵌套对象结构
✅ **统计反馈**: 提示用户有多少键需要翻译

## 后续建议

1. **完善翻译**: 对使用fallback的键执行翻译操作
2. **定期检查**: 定期执行导出查看哪些键还需要翻译
3. **自动化**: 可考虑在导出时自动标记未翻译的键
