# 目标语言配置改进测试

## 测试场景

### 场景1：选择现有文件
1. 点击"选择路径"按钮
2. 选择"选择现有文件"
3. 在文件选择对话框中选择一个现有的 JSON 文件
4. **预期结果**：输出路径字段显示选择的文件完整路径

### 场景2：选择目录
1. 点击"选择路径"按钮  
2. 选择"选择目录"
3. 选择一个目录
4. **预期结果**：输出路径显示为 `目录路径/[语言代码].json`

### 场景3：智能路径更新
1. 先选择一个目录（如 `./locales/`）
2. 修改语言代码（如从 `en` 改为 `fr`）
3. **预期结果**：输出路径自动更新为 `./locales/fr.json`

### 场景4：文件路径不自动更新
1. 选择现有文件（如 `./translations/english.json`）
2. 修改语言代码
3. **预期结果**：输出路径保持不变，因为用户明确选择了具体文件

## 功能改进点

### ✅ 文件选择支持
- 支持选择现有的 JSON 文件，不会覆盖或创建文件
- 简化的选择流程，直接选择文件或目录
- 支持与源语言文件相同格式的文件选择

### ✅ 简化的选择模式
- **文件模式**：直接选择现有 JSON 文件
- **目录模式**：选择目录，自动生成文件名

### ✅ 智能路径管理
- 目录选择后，语言代码变更会自动更新文件名
- 文件选择后，保持用户指定的路径不变
- 空路径时，自动使用默认路径

### ✅ 用户体验改进
- 清晰的选择提示
- 按钮标题说明功能
- 占位符文本指导用户操作

## 代码实现要点

### 1. 双重选择逻辑
```typescript
const choice = await vscode.window.showQuickPick([
    {
        label: '选择具体文件',
        description: '选择一个现有的 JSON 文件或指定新文件名'
    },
    {
        label: '选择目录',
        description: '选择一个目录，系统会自动生成文件名'
    }
])
```

### 2. 文件选择对话框
```typescript
// 选择现有文件
const files = await vscode.window.showOpenDialog({
    canSelectFiles: true,
    filters: { 'JSON 文件': ['json'] },
    title: '选择现有的目标语言文件'
})
```

### 3. 智能路径更新
```javascript
function updateOutputPathForLang(index) {
    // 检查是否为目录路径
    if (!currentPath.endsWith('.json')) {
        // 自动更新文件名
        pathInput.value = `${basePath}${langCode}.json`;
    }
}
```

## 解决的问题

1. **原问题**：选择文件时流程过于复杂，有不必要的选择步骤
2. **解决方案**：
   - 简化选择流程：直接选择"现有文件"或"目录"
   - 移除冗余的文件指定方式选择
   - 保持功能完整性的同时提升用户体验
3. **额外改进**：智能路径管理，提升用户体验

## 兼容性

- ✅ 向后兼容现有配置
- ✅ 支持字符串和对象格式的目标语言配置
- ✅ 保持原有的默认路径逻辑
- ✅ 不影响现有的配置验证
